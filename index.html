è¿™æ˜¯ä¸€ä¸ªæ ¹æ®æ‚¨çš„éœ€æ±‚ä¿®æ”¹åçš„å®Œæ•´ä»£ç ã€‚

**ä¸»è¦ä¿®æ”¹ç‚¹ï¼š**

1. **ä¸‹æ‹‰èœå•ç”Ÿæˆé€»è¾‘**ï¼šä¸å†ä½¿ç”¨é¢„è®¾çš„ `PRESETS` æ•°ç»„ï¼Œè€Œæ˜¯è‡ªåŠ¨ç”Ÿæˆ **1 åˆ° 10** çš„ç¼–å·é€‰é¡¹ï¼Œå¯¹åº”çš„æ–‡ä»¶åé»˜è®¤ä¸º `1.csv` åˆ° `10.csv`ã€‚
2. **æ ‡é¢˜æå–é€»è¾‘**ï¼šåœ¨è§£æ CSV æ—¶ï¼Œä¼šè‡ªåŠ¨è¯»å–**æœ€åä¸€è¡Œ**ã€‚å¦‚æœæœ€åä¸€è¡Œç¬¦åˆ `æ ‡é¢˜,æ ‡é¢˜` çš„æ ¼å¼ï¼Œå®ƒä¼šè¢«æå–å¹¶åœ¨é¡µé¢é¡¶éƒ¨ `<h1>` æ ‡ç­¾ä¸­æ˜¾ç¤ºï¼ŒåŒæ—¶è¯¥è¡Œä¸ä¼šä½œä¸ºé¢˜ç›®å‡ºç°åœ¨å¡ç‰‡ä¸­ã€‚
3. **æ–‡ä»¶æ ¼å¼è¦æ±‚**ï¼šè¯·ç¡®ä¿æ‚¨çš„ CSV æ–‡ä»¶åä¸º `1.csv`, `2.csv` ... `10.csv`ï¼Œä¸”æ–‡ä»¶æœ€åä¸€è¡Œæ ¼å¼ä¸º `æ‚¨çš„æ ‡é¢˜,æ‚¨çš„æ ‡é¢˜`ã€‚

### å®Œæ•´ä»£ç  (index.html)

æ‚¨å¯ä»¥ç›´æ¥å¤åˆ¶å¹¶è¦†ç›–åŸæ–‡ä»¶ï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>ä¸Šä½æœºé¢è¯•é—ªå¡</title>

<style>
    :root {
        --primary-color: #2563eb; /* è“è‰²ç³»ï¼Œæ›´ä¸“ä¸š */
        --bg-color: #f8fafc;
        --card-height: 380px; 
        --card-width: 90%;
        --max-width: 420px;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: var(--bg-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 10px;
        margin: 0;
        min-height: 100vh;
        overflow-x: hidden;
        -webkit-tap-highlight-color: transparent;
        color: #333;
    }

    h1 {
        margin: 10px 0 20px 0;
        font-size: 20px;
        font-weight: 700;
        color: #1e293b;
        text-align: center;
        padding: 0 10px;
    }

    /* é¡¶éƒ¨æ§åˆ¶å®¹å™¨ */
    .controls-container {
        width: 100%;
        max-width: var(--max-width);
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 20px;
    }

    /* é¢˜åº“ä¸‹æ‹‰æ¡† */
    .topic-select {
        width: 100%;
        padding: 14px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        background: white;
        font-size: 16px;
        font-weight: 500;
        color: #334155;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        appearance: none;
        /* ä¸‹æ‹‰ç®­å¤´å›¾æ ‡ */
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23334155' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 1.2em;
    }
    
    .topic-select:focus {
        outline: 2px solid var(--primary-color);
        border-color: transparent;
    }

    /* åŠŸèƒ½æ  (ä¹±åºã€é‡ç½®) */
    .controls-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        padding: 10px 16px;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .control-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        color: #475569;
    }

    /* iOS é£æ ¼å¼€å…³ */
    .switch {
        position: relative;
        display: inline-block;
        width: 44px;
        height: 24px;
    }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0; left: 0; right: 0; bottom: 0;
        background-color: #cbd5e1;
        transition: .3s;
        border-radius: 24px;
    }
    .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .3s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    input:checked + .slider { background-color: var(--primary-color); }
    input:checked + .slider:before { transform: translateX(20px); }

    .restart-btn {
        background: transparent;
        border: 1px solid #e2e8f0;
        padding: 6px 12px;
        border-radius: 8px;
        color: #64748b;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
    }
    .restart-btn:active { background: #f1f5f9; }

    /* è¿›åº¦æ¡ */
    #progressContainer {
        width: 100%;
        max-width: var(--max-width);
        height: 4px;
        background: #e2e8f0;
        border-radius: 2px;
        margin-bottom: 8px;
        overflow: hidden;
        display: none;
    }
    #progressBar {
        height: 100%;
        width: 0%;
        background: var(--primary-color);
        transition: width 0.3s ease;
    }
    #progressText {
        font-size: 12px;
        color: #94a3b8;
        margin-bottom: 15px;
        display: none;
    }

    /* å¡ç‰‡åŒºåŸŸ */
    .scene {
        width: var(--card-width);
        max-width: var(--max-width);
        height: var(--card-height);
        perspective: 1000px;
        margin-bottom: 20px;
    }

    .card {
        width: 100%;
        height: 100%;
        position: relative;
        transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
        transform-style: preserve-3d;
        cursor: pointer;
    }

    .card.is-flipped { transform: rotateY(180deg); }

    .card__face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        border-radius: 16px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 30px;
        box-sizing: border-box;
        text-align: center;
        font-size: 20px;
        line-height: 1.6;
        background: white;
        overflow-y: auto;
    }

    /* æ­£é¢é—®é¢˜ */
    .card__face--front { 
        background: white; 
        font-weight: 600;
        color: #1e293b;
    }
    
    /* èƒŒé¢ç­”æ¡ˆ */
    .card__face--back {
        background: #f0f9ff; /* ææ·¡çš„è“è‰²èƒŒæ™¯ */
        transform: rotateY(180deg);
        border: 2px solid var(--primary-color);
        color: #334155;
        font-size: 17px;
        justify-content: flex-start; /* ç­”æ¡ˆä»é¡¶éƒ¨å¼€å§‹ï¼Œæ–¹ä¾¿é•¿æ–‡é˜…è¯» */
        padding-top: 40px; 
    }

    .instruction-hint {
        font-size: 12px;
        color: #cbd5e1;
        margin-top: 10px;
        text-align: center;
    }

    /* æŒ‰é’®ç»„ */
    .btn-group {
        display: flex;
        width: var(--card-width);
        max-width: var(--max-width);
        gap: 15px;
        margin-bottom: 30px;
    }

    .btn {
        flex: 1;
        padding: 14px 0;
        font-size: 16px;
        border: none;
        border-radius: 12px;
        background: white;
        color: #475569;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.1s;
    }
    
    .btn:active {
        background: #f8fafc;
        transform: scale(0.98);
    }
    
    /* åŠ è½½åŠ¨ç”» */
    .loader {
        border: 2px solid #f3f3f3;
        border-top: 2px solid var(--primary-color);
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 1s linear infinite;
        display: none;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

</style>
</head>

<body>

<h1 id="pageTitle">âš¡ï¸ ä¸Šä½æœºé«˜é¢‘é¢è¯•é¢˜</h1>

<div class="controls-container">
    <select id="topicSelect" class="topic-select">
        <option value="" disabled selected>ğŸ“‚ ç‚¹å‡»é€‰æ‹©é¢˜åº“...</option>
    </select>

    <div class="controls-bar">
        <div class="control-item">
            <label class="switch">
                <input type="checkbox" id="shuffleToggle">
                <span class="slider"></span>
            </label>
            <span>éšæœºä¹±åº</span>
        </div>
        <div class="loader" id="loader"></div>
        <button class="restart-btn" id="restartBtn">â†º é‡ç½®</button>
    </div>
</div>

<div id="progressContainer">
    <div id="progressBar"></div>
</div>
<div id="progressText">0 / 0</div>

<div class="scene">
    <div class="card" id="card">
        <div class="card__face card__face--front">
            <div id="questionText">è¯·åœ¨ä¸Šæ–¹é€‰æ‹©ç¼–å·<br>å¼€å§‹åˆ·é¢˜</div>
        </div>
        <div class="card__face card__face--back">
            <div id="answerText"></div>
        </div>
    </div>
</div>

<div class="instruction-hint">
    ç‚¹å‡»ç¿»é¢ â€¢ å·¦æ»‘ä¸‹ä¸€é¢˜ â€¢ å³æ»‘ä¸Šä¸€é¢˜
</div>

<div class="btn-group">
    <button class="btn" id="prevBtn">ä¸Šä¸€é¢˜</button>
    <button class="btn" id="nextBtn">ä¸‹ä¸€é¢˜</button>
</div>

<script>
/**
 * ===================================================
 * é€»è¾‘åŒºåŸŸ
 * ===================================================
 */

// --- çŠ¶æ€å˜é‡ ---
let rawCSVContent = "";     
let originalCards = [];     
let activeCards = [];       
let currentIndex = 0;
let isShuffle = false;
let currentFileName = "";

// --- DOM å…ƒç´  ---
const cardElement = document.getElementById('card');
const questionText = document.getElementById('questionText');
const answerText = document.getElementById('answerText');
const shuffleToggle = document.getElementById('shuffleToggle');
const progressBar = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');
const progressContainer = document.getElementById('progressContainer');
const topicSelect = document.getElementById('topicSelect');
const loader = document.getElementById('loader');
const pageTitle = document.getElementById('pageTitle');

// --- åˆå§‹åŒ– ---
window.addEventListener('DOMContentLoaded', () => {
    // 1. åˆå§‹åŒ–ä¸‹æ‹‰èœå•ï¼šç”Ÿæˆ 1 åˆ° 10 çš„é€‰é¡¹
    for (let i = 1; i <= 10; i++) {
        const opt = document.createElement('option');
        opt.value = `${i}.csv`; // å¯¹åº”æ–‡ä»¶ 1.csv, 2.csv ...
        opt.textContent = `é¢˜åº“ç¼–å· ${i}`; // æ˜¾ç¤ºæ–‡æœ¬
        topicSelect.appendChild(opt);
    }

    // 2. åŠ è½½ä¸Šæ¬¡è¿›åº¦
    loadProgress();
});

// --- æ ¸å¿ƒï¼šåŠ è½½æ•°æ® ---
topicSelect.addEventListener('change', async function(e) {
    const filename = e.target.value;
    if(!filename) return;
    
    await loadRemoteFile(filename);
    this.blur(); // ç§»é™¤ç„¦ç‚¹ï¼Œé˜²æ­¢è¯¯è§¦é”®ç›˜
});

async function loadRemoteFile(filename) {
    currentFileName = filename;
    showLoader(true);
    
    try {
        // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢æµè§ˆå™¨ç¼“å­˜æ—§ç‰ˆæœ¬
        const response = await fetch(`./data/${filename}?v=${Date.now()}`);
        
        if (!response.ok) {
            throw new Error(`HTTP Error: ${response.status}`);
        }
        
        const text = await response.text();
        rawCSVContent = text;
        currentIndex = 0; // åˆ‡æ¢æ–‡ä»¶æ—¶é‡ç½®ç´¢å¼•
        
        parseAndInit(rawCSVContent);
    } catch (err) {
        console.error(err);
        pageTitle.textContent = "âš ï¸ åŠ è½½å¤±è´¥";
        questionText.innerHTML = `âš ï¸ åŠ è½½å¤±è´¥<br><span style="font-size:14px;color:#999">è¯·ç¡®è®¤ data/${filename} æ–‡ä»¶å­˜åœ¨</span>`;
        alert("æ— æ³•è¯»å–æ–‡ä»¶ï¼Œè¯·æ£€æŸ¥ data æ–‡ä»¶å¤¹ä¸‹æ˜¯å¦æœ‰å¯¹åº”çš„æ•°å­—ç¼–å· CSV æ–‡ä»¶ã€‚");
    } finally {
        showLoader(false);
    }
}

// --- CSV è§£æé€»è¾‘ (åŒ…å«æ ‡é¢˜æå–) ---
function parseAndInit(csvText) {
    // 1. åˆ†å‰²è¡Œå¹¶å»é™¤ç©ºè¡Œ
    let lines = csvText.split(/\r?\n/).filter(line => line.trim() !== "");
    originalCards = [];

    // 2. æ£€æŸ¥æœ€åä¸€è¡Œæ˜¯å¦ä¸ºæ ‡é¢˜
    // é€»è¾‘ï¼šå¦‚æœæœ€åä¸€è¡Œæ˜¯ "æ ‡é¢˜,æ ‡é¢˜"ï¼Œåˆ™å°†å…¶æå–ä¸ºé¡µé¢æ ‡é¢˜
    if (lines.length > 0) {
        const lastLine = lines[lines.length - 1];
        const lastCommaIndex = lastLine.indexOf(',');
        
        if (lastCommaIndex > -1) {
            const partA = lastLine.substring(0, lastCommaIndex).trim();
            const partB = lastLine.substring(lastCommaIndex + 1).trim();
            
            // å¦‚æœé€—å·å‰åå†…å®¹ä¸€è‡´ï¼Œè®¤ä¸ºæ˜¯æ ‡é¢˜è¡Œ
            if (partA === partB && partA.length > 0) {
                // è®¾ç½®é¡µé¢æ ‡é¢˜
                pageTitle.textContent = partA;
                // ä»æ•°æ®æºä¸­ç§»é™¤æœ€åä¸€è¡Œï¼Œä¸ä½œä¸ºé¢˜ç›®æ˜¾ç¤º
                lines.pop();
            } else {
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ ‡é¢˜è¡Œï¼Œè®¾ç½®é»˜è®¤æ ‡é¢˜
                pageTitle.textContent = "ä¸Šä½æœºé¢è¯•é—ªå¡";
            }
        }
    }

    // 3. è§£æå‰©ä½™è¡Œä½œä¸ºé¢˜ç›®
    for (const line of lines) {
        const firstCommaIndex = line.indexOf(',');
        
        if (firstCommaIndex > -1) {
            let q = line.substring(0, firstCommaIndex).trim();
            let a = line.substring(firstCommaIndex + 1).trim();
            
            // æ¸…ç† BOM å¤´æˆ–ç©ºç™½
            q = q.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, '');
            
            if(q && a) {
                originalCards.push({ question: q, answer: a });
            }
        }
    }

    if (originalCards.length === 0) {
        alert("æ–‡ä»¶å†…å®¹ä¸ºç©ºæˆ–æ— æœ‰æ•ˆé¢˜ç›®æ•°æ®");
        return;
    }

    applyModeAndRender();
}

// --- æ¸²æŸ“é€»è¾‘ ---
function applyModeAndRender() {
    isShuffle = shuffleToggle.checked;

    if (isShuffle) {
        // å¤åˆ¶ä¸€ä»½å¹¶æ‰“ä¹±
        activeCards = [...originalCards];
        shuffleArray(activeCards);
    } else {
        // ä½¿ç”¨åŸå§‹é¡ºåº
        activeCards = [...originalCards];
    }

    // ç´¢å¼•è¶Šç•Œä¿æŠ¤
    if (currentIndex >= activeCards.length) currentIndex = 0;
    
    // æ˜¾ç¤ºUIç»„ä»¶
    progressContainer.style.display = "block";
    progressText.style.display = "block";
    
    // ç¿»å›æ­£é¢
    cardElement.classList.remove('is-flipped');
    
    updateCardContent();
}

function updateCardContent() {
    if (activeCards.length === 0) return;
    
    const item = activeCards[currentIndex];
    
    questionText.innerHTML = item.question;
    answerText.innerHTML = item.answer.replace(/\\n/g, '<br>'); // æ”¯æŒæ‰‹åŠ¨æ¢è¡Œç¬¦

    // æ›´æ–°è¿›åº¦æ¡
    const current = currentIndex + 1;
    const total = activeCards.length;
    const percent = (current / total) * 100;

    progressBar.style.width = percent + "%";
    progressText.textContent = `è¿›åº¦: ${current} / ${total}`;

    saveProgress();
}

// --- æœ¬åœ°å­˜å‚¨ (è®°å¿†åŠŸèƒ½) ---
function saveProgress() {
    if (!currentFileName) return;
    const state = {
        file: currentFileName,
        index: currentIndex,
        shuffle: isShuffle
    };
    localStorage.setItem('flashcard_state_v3', JSON.stringify(state));
}

function loadProgress() {
    const saved = localStorage.getItem('flashcard_state_v3');
    if (saved) {
        try {
            const state = JSON.parse(saved);
            if (state.file) {
                // æ¢å¤ UI çŠ¶æ€
                isShuffle = state.shuffle;
                shuffleToggle.checked = isShuffle;
                topicSelect.value = state.file;
                
                // æ¢å¤è¿›åº¦ç´¢å¼• (æš‚å­˜åˆ°å…¨å±€ï¼Œç­‰æ–‡ä»¶åŠ è½½å®Œåä½¿ç”¨)
                currentIndex = state.index || 0;
                
                // è‡ªåŠ¨åŠ è½½æ–‡ä»¶
                loadRemoteFile(state.file);
            }
        } catch (e) { console.error("Load state error", e); }
    }
}

// --- å·¥å…·å‡½æ•° ---
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}
function showLoader(show) {
    loader.style.display = show ? "block" : "none";
}

// --- äº¤äº’äº‹ä»¶ ---

// 1. ä¹±åºå¼€å…³
shuffleToggle.addEventListener('change', () => {
    currentIndex = 0; // åˆ‡æ¢æ¨¡å¼æ—¶é‡ç½®åˆ°ç¬¬ä¸€é¢˜ï¼Œé¿å…æ··ä¹±
    applyModeAndRender();
});

// 2. é‡ç½®æŒ‰é’®
document.getElementById('restartBtn').addEventListener('click', () => {
    if (activeCards.length === 0) return;
    if (confirm("ç¡®å®šè¦é‡æ–°å¼€å§‹å½“å‰é¢˜åº“å—ï¼Ÿ")) {
        currentIndex = 0;
        cardElement.classList.remove('is-flipped');
        if(isShuffle) shuffleArray(activeCards);
        updateCardContent();
    }
});

// 3. å¡ç‰‡ç‚¹å‡»ç¿»è½¬
cardElement.addEventListener('click', () => {
    if(activeCards.length > 0) cardElement.classList.toggle('is-flipped');
});

// 4. åˆ‡æ¢é¢˜ç›® (å¸¦å»¶æ—¶ä»¥é˜²åŠ¨ç”»å†²çª)
function nextQuestion() {
    if (activeCards.length === 0) return;
    currentIndex = (currentIndex + 1) % activeCards.length;
    cardElement.classList.remove('is-flipped');
    setTimeout(updateCardContent, 200);
}

function prevQuestion() {
    if (activeCards.length === 0) return;
    currentIndex = (currentIndex - 1 + activeCards.length) % activeCards.length;
    cardElement.classList.remove('is-flipped');
    setTimeout(updateCardContent, 200);
}

document.getElementById('nextBtn').addEventListener('click', (e) => { e.stopPropagation(); nextQuestion(); });
document.getElementById('prevBtn').addEventListener('click', (e) => { e.stopPropagation(); prevQuestion(); });

// 5. æ»‘åŠ¨æ‰‹åŠ¿ (Mobile Swipe)
let touchStartX = 0;
document.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; });
document.addEventListener('touchend', e => {
    const touchEndX = e.changedTouches[0].screenX;
    const distance = touchEndX - touchStartX;
    // æ»‘åŠ¨è·ç¦»å¤§äº 50px æ‰è§¦å‘
    if (Math.abs(distance) > 50) {
        if (distance < 0) nextQuestion(); // å·¦æ»‘ -> ä¸‹ä¸€é¢˜
        else prevQuestion();              // å³æ»‘ -> ä¸Šä¸€é¢˜
    }
});

// 6. é”®ç›˜æ”¯æŒ (PCè°ƒè¯•ç”¨)
document.addEventListener('keydown', (e) => {
    if(e.key === "ArrowRight") nextQuestion();
    if(e.key === "ArrowLeft") prevQuestion();
    if(e.key === " " || e.key === "Enter") cardElement.classList.toggle('is-flipped');
});

</script>
</body>
</html>

```
